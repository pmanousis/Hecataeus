CREATE TABLE ODS_PROVCOMMPROD
(
  PROVCOMMPROD_SK            NUMBER(5)          NOT NULL,
  PROVCOMMPROD_CODE          VARCHAR2(20 BYTE)  NOT NULL,
  PROVCOMMPROD_DESCR         VARCHAR2(100 BYTE),
  PROVCOMMPROD_GROUP         NUMBER(5)          NOT NULL,
  PROVCOMMPROD_CHANNEL       NUMBER(5),
  PROVCOMMPROD_ORDER         NUMBER(10),
  PROVCOMMPROD_CREATIONDATE  DATE               NOT NULL,
  PROVCOMMPROD_CREATIONUSER  VARCHAR2(30 BYTE)  NOT NULL,
  PROVCOMMPROD_LASTUPDDATE   DATE,
  PROVCOMMPROD_LASTUPDUSER   VARCHAR2(30 BYTE),
  PROVCOMMPROD_PERIFCODE     VARCHAR2(20 BYTE)
)
TABLESPACE ODS_ODS_TBL
PCTUSED    0
PCTFREE    10
INITRANS   1
MAXTRANS   255
STORAGE    (
            INITIAL          160K
            MINEXTENTS       1
            MAXEXTENTS       2147483645
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           )
LOGGING 
NOCOMPRESS 
NOCACHE
NOPARALLEL
MONITORING;


CREATE UNIQUE INDEX ODS_PROVCOMMPROD_CODE_UIDX ON ODS_PROVCOMMPROD
(PROVCOMMPROD_CODE)
LOGGING
TABLESPACE INDEXES
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          160K
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       2147483645
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           )
NOPARALLEL;


CREATE UNIQUE INDEX ODS_PROVCOMMPROD_PIDX ON ODS_PROVCOMMPROD
(PROVCOMMPROD_SK)
LOGGING
TABLESPACE INDEXES
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          160K
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       2147483645
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           )
NOPARALLEL;


CREATE BITMAP INDEX ODS_PROVCOMMPROD_GROUP_BIDX ON ODS_PROVCOMMPROD
(PROVCOMMPROD_GROUP)
LOGGING
TABLESPACE INDEXES
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          160K
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       2147483645
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           )
NOPARALLEL;


CREATE OR REPLACE TRIGGER ODS_PROVCOMMPROD_BIUR_TRI BEFORE INSERT OR UPDATE ON ODS_PROVCOMMPROD
FOR EACH ROW
DECLARE
	   tmpVar NUMBER;
/******************************************************************************
   COMPANY: ORACLE
   PROJECT: MIS
   NAME:	ODS_PROVCOMMPROD_BIUR_TRI
   PURPOSE: Default values for several columns of the table
   NOTES:

   REVISIONS:
   Ver        Date        Author           Description
   ---------  ----------  ---------------  ------------------------------------
   1.0        4/01/2007   GPAPOUTS         1. Created this trigger.
******************************************************************************/
BEGIN
	 IF INSERTING THEN
	 	IF :NEW.PROVCOMMPROD_SK IS NULL THEN
          SELECT ODS_PROVCOMMPROD_SEQ.NEXTVAL INTO tmpVar FROM dual;
          :NEW.PROVCOMMPROD_SK := tmpVar;
		END IF;
		:NEW.PROVCOMMPROD_CREATIONDATE	:= SYSDATE;
     	:NEW.PROVCOMMPROD_CREATIONUSER	:= nvl(v('APP_USER'), user);
--
		INSERT INTO ODS_PROVCOMMPROD_TARG (PROVCOMMPROD_DISCRIMINATOR, PROVCOMMPROD_DISCRDESCR, PROVCOMMPROD_CODE, PROVCOMMPROD_DESCR)
			   VALUES (2, 'Ai?ineeu ?niuui', :NEW.PROVCOMMPROD_CODE, :NEW.PROVCOMMPROD_DESCR);
	 ELSIF UPDATING THEN
		 :NEW.PROVCOMMPROD_LASTUPDDATE	:= SYSDATE;
     	 :NEW.PROVCOMMPROD_LASTUPDUSER := nvl(v('APP_USER'), user);
--
  		 IF :NEW.PROVCOMMPROD_CODE != :OLD.PROVCOMMPROD_CODE THEN
		 	BEGIN
				 INSERT INTO ODS_PROVCOMMPROD_TARG (PROVCOMMPROD_DISCRIMINATOR, PROVCOMMPROD_DISCRDESCR, PROVCOMMPROD_CODE, PROVCOMMPROD_DESCR)
			   	 		VALUES (2, 'Ai?ineeu ?niuui', :NEW.PROVCOMMPROD_CODE, :NEW.PROVCOMMPROD_DESCR);
			EXCEPTION
				 WHEN DUP_VAL_ON_INDEX THEN
				 	  NULL;
			END;
		 END IF;
  		 IF :NEW.PROVCOMMPROD_DESCR != :OLD.PROVCOMMPROD_DESCR AND :NEW.PROVCOMMPROD_CODE = :OLD.PROVCOMMPROD_CODE THEN
		 	  UPDATE ODS_PROVCOMMPROD_TARG SET PROVCOMMPROD_DESCR = :NEW.PROVCOMMPROD_DESCR
		  		 WHERE PROVCOMMPROD_DISCRIMINATOR = 2
				 AND PROVCOMMPROD_CODE = :NEW.PROVCOMMPROD_CODE;
		 END IF;
	 END IF;
EXCEPTION
		 WHEN OTHERS THEN
-- Consider logging the error and then re-raise
   			RAISE;
END  ODS_PROVCOMMPROD_BIUR_TRI;
/
SHOW ERRORS;



ALTER TABLE ODS_PROVCOMMPROD ADD (
  CONSTRAINT ODS_PROVCOMMPROD_PK
 PRIMARY KEY
 (PROVCOMMPROD_SK));

ALTER TABLE ODS_PROVCOMMPROD ADD (
  CONSTRAINT ODS_PROVCOMMPROD_CODE_UK
 UNIQUE (PROVCOMMPROD_CODE));


ALTER TABLE ODS_PROVCOMMPROD ADD (
  CONSTRAINT ODS_PROVCOMMPROD_GROUP_FK 
 FOREIGN KEY (PROVCOMMPROD_GROUP) 
 REFERENCES ODS_PROVCOMMPRODGROUP (PROVCOMMPRODGROUP_SK));


GRANT ALTER, DELETE, INDEX, INSERT, REFERENCES, SELECT, UPDATE, ON COMMIT REFRESH, QUERY REWRITE, DEBUG, FLASHBACK ON  ODS_PROVCOMMPROD TO MIS WITH GRANT OPTION;